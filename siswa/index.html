<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard Siswa - MindUp</title>
    
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600&family=Poppins:wght@500;600;700&display=swap" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/sweetalert2@11/dist/sweetalert2.min.css" rel="stylesheet">

    <style>
        :root {
            --primary-blue: #0d6efd;
            --dark-blue: #0a429b;
            --light-blue-bg: #f0f7ff;
            --text-dark: #212529;
            --card-hover: 0 10px 20px rgba(13, 110, 253, 0.1);
        }

        body {
            font-family: 'Inter', sans-serif;
            background-color: #f8f9fa;
            padding-top: 80px; /* Space untuk navbar fixed */
        }

        h1, h2, h3, h4, h5, .navbar-brand { font-family: 'Poppins', sans-serif; }

        /* Navbar Styling */
        .navbar {
            background-color: white;
            box-shadow: 0 2px 15px rgba(0,0,0,0.03);
        }
        .navbar-brand { font-weight: 700; color: var(--primary-blue) !important; }
        .nav-profile-img { 
            width: 40px; height: 40px; border-radius: 50%; object-fit: cover; border: 2px solid var(--primary-blue); 
        }

        /* Banner Welcome */
        .welcome-banner {
            background: linear-gradient(135deg, var(--primary-blue) 0%, var(--dark-blue) 100%);
            color: white; border-radius: 20px; padding: 40px; margin-bottom: 30px; 
            position: relative; overflow: hidden;
        }
        .welcome-banner::after {
            content: ''; position: absolute; top: -50%; right: -10%; width: 300px; height: 300px;
            background: rgba(255,255,255,0.1); border-radius: 50%;
        }

        /* Module Cards */
        .module-card {
            border: none; border-radius: 15px; transition: all 0.3s ease; background: white;
            height: 100%; cursor: pointer; overflow: hidden;
        }
        .module-card:hover { transform: translateY(-5px); box-shadow: var(--card-hover); }
        
        .card-icon-wrapper {
            width: 60px; height: 60px; background-color: var(--light-blue-bg); border-radius: 12px;
            display: flex; align-items: center; justify-content: center; font-size: 1.5rem; 
            margin-bottom: 15px;
        }

        /* Quick Actions */
        .quick-action-card { background: white; border-radius: 15px; border: none; padding: 20px; margin-bottom: 20px; }
        
        .btn-journal {
            background-color: #ff9f43; color: white; border: none; width: 100%; padding: 12px;
            border-radius: 10px; font-weight: 600; display: flex; align-items: center; justify-content: center;
            transition: 0.3s;
        }
        .btn-journal:hover { background-color: #f39c12; color: white; transform: scale(1.02); }

        /* Modal Custom */
        .modal-content { border-radius: 20px; border: none; }
    </style>
</head>
<body>

    <nav class="navbar navbar-expand-lg fixed-top">
        <div class="container">
            <a class="navbar-brand" href="index.html">
                <i class="bi bi-layers-half me-2"></i>MindUp <span class="badge bg-light text-primary border ms-2" style="font-size: 0.6em;">SISWA</span>
            </a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav ms-auto align-items-center">
                    <li class="nav-item dropdown ms-lg-3">
                        <a class="nav-link dropdown-toggle d-flex align-items-center" href="#" role="button" data-bs-toggle="dropdown">
                            <span class="me-2 d-none d-lg-block text-dark fw-bold" id="navUserName">Siswa MindUp</span>
                            <img src="https://ui-avatars.com/api/?name=Siswa+M&background=0d6efd&color=fff" alt="Profile" class="nav-profile-img">
                        </a>
                        <ul class="dropdown-menu dropdown-menu-end border-0 shadow">
                            <li><a class="dropdown-item" href="profil.html"><i class="bi bi-person me-2"></i>Profil Saya</a></li>
                            <li><hr class="dropdown-divider"></li>
                            <li><a class="dropdown-item text-danger" href="#" onclick="handleLogout()"><i class="bi bi-box-arrow-right me-2"></i>Keluar</a></li>
                        </ul>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <div class="container py-4">
        <div class="row">
            <div class="col-lg-8">
                
                <div class="welcome-banner shadow-sm">
                    <h2 class="fw-bold">Halo, <span id="bannerUserName">Rangga</span>! ðŸ‘‹</h2>
                    <p class="mb-0 opacity-75">"Resiliensi bukan tentang seberapa kuat kamu memukul, tapi seberapa cepat kamu bangkit."</p>
                    <div class="mt-3">
                        <span class="badge bg-white text-primary bg-opacity-25 backdrop-blur text-white">
                            <i class="bi bi-building me-1"></i> SMAN 1 BIMA - KELAS XII
                        </span>
                    </div>
                </div>

                <div class="d-flex justify-content-between align-items-center mb-4">
                    <h4 class="fw-bold m-0 text-dark">Materi Resiliensi</h4>
                    <div class="btn-group" role="group">
                        <button type="button" class="btn btn-outline-primary active btn-sm rounded-pill me-2 px-3" onclick="filterModules('all', this)">Semua</button>
                        <button type="button" class="btn btn-outline-secondary btn-sm rounded-pill px-3" onclick="filterModules('audio', this)">Audio</button>
                    </div>
                </div>

                <div class="row g-4" id="moduleContainer">
                    </div>

            </div>

            <div class="col-lg-4 mt-4 mt-lg-0">
                
                <div class="quick-action-card shadow-sm text-center">
                    <div class="mb-3">
                        <div style="font-size: 3rem;">ðŸ¤”</div>
                    </div>
                    <h5 class="fw-bold">Apa kabar hatimu?</h5>
                    <p class="text-muted small">Luangkan 5 menit untuk mencatat perasaanmu hari ini. Privasi terjaga.</p>
                    <a href="jurnal.html" class="btn btn-journal shadow-sm text-decoration-none">
                        <i class="bi bi-pencil-square me-2"></i> Tulis Jurnal
                    </a>
                </div>

                <div class="quick-action-card shadow-sm">
                    <h6 class="fw-bold mb-3"><i class="bi bi-headphones me-2 text-primary"></i>P3K (Pertolongan Cemas)</h6>
                    <div class="list-group list-group-flush">
                        <a href="#" onclick="playQuickAudio('Relaksasi Pernapasan')" class="list-group-item list-group-item-action d-flex align-items-center px-0 border-0">
                            <div class="bg-light rounded p-2 me-3"><i class="bi bi-play-fill text-primary"></i></div>
                            <div>
                                <div class="fw-bold small">Tarik Napas (4-7-8)</div>
                                <div class="text-muted" style="font-size: 0.75rem;">Teknik Penenang</div>
                            </div>
                        </a>
                        <a href="#" onclick="playQuickAudio('Afirmasi Positif')" class="list-group-item list-group-item-action d-flex align-items-center px-0 border-0">
                            <div class="bg-light rounded p-2 me-3"><i class="bi bi-play-fill text-primary"></i></div>
                            <div>
                                <div class="fw-bold small">Saya Pasti Bisa</div>
                                <div class="text-muted" style="font-size: 0.75rem;">Booster Percaya Diri</div>
                            </div>
                        </a>
                    </div>
                    <div class="mt-3 text-center">
                         <a href="relaksasi.html" class="text-decoration-none small fw-bold">Lihat Semua Audio <i class="bi bi-arrow-right"></i></a>
                    </div>
                </div>

            </div>
        </div>
    </div>

    <div class="modal fade" id="moduleModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title fw-bold" id="modalTitle">Judul Materi</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <span id="modalBadge" class="badge bg-primary mb-3">Kategori</span>
                    <p id="modalDesc" class="text-muted">Deskripsi materi akan muncul di sini.</p>
                    <div class="alert alert-light border d-flex align-items-center" role="alert">
                        <i class="bi bi-clock me-2 text-primary"></i>
                        <span class="small">Estimasi waktu: <strong id="modalDuration">10 Menit</strong></span>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary rounded-pill px-4" data-bs-dismiss="modal">Tutup</button>
                    <button type="button" class="btn btn-primary rounded-pill px-4" id="btnStartLearning">Mulai Belajar</button>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

    <script>
        // --- 1. CEK OTENTIKASI (PENTING) ---
        // Cek apakah user sudah login dan role-nya 'Siswa'
        const userRole = localStorage.getItem('userRole');
        const isLoggedIn = localStorage.getItem('isLoggedIn');

        if (!isLoggedIn || userRole !== 'Siswa') {
            // Jika akses ilegal, tendang ke login page di folder luar
            window.location.href = '../login.html';
        }

        // Setup Nama User (Simulasi)
        document.addEventListener('DOMContentLoaded', () => {
            const userName = localStorage.getItem('userName') || 'Sobat MindUp';
            document.getElementById('navUserName').innerText = userName;
            document.getElementById('bannerUserName').innerText = userName;
        });

        // --- 2. LOGOUT FUNCTION ---
        function handleLogout() {
            Swal.fire({
                title: 'Keluar?',
                text: "Sesi Anda akan diakhiri.",
                icon: 'question',
                showCancelButton: true,
                confirmButtonColor: '#d33',
                cancelButtonColor: '#3085d6',
                confirmButtonText: 'Ya, Keluar'
            }).then((result) => {
                if (result.isConfirmed) {
                    localStorage.clear(); // Hapus data sesi
                    window.location.href = '../login.html'; // Kembali ke halaman login utama
                }
            });
        }

        // --- 3. DATA MATERI (JSON Dummy) ---
        const modulesData = [
            { id: 1, title: "Pengenalan Resiliensi", desc: "Dasar ketangguhan mental untuk pelajar.", type: "Materi Teks", category: "text", icon: "bi-book", duration: "10 Menit", color: "text-primary" },
            { id: 2, title: "Mengenal Emosi Diri", desc: "Teknik menyadari perubahan emosi (State Awareness).", type: "Audio & Teks", category: "audio", icon: "bi-emoji-smile", duration: "15 Menit", color: "text-success" },
            { id: 3, title: "Teknik 'Anchor' Positif", desc: "Menanamkan pemicu rasa tenang kapanpun dibutuhkan.", type: "Audio Terapi", category: "audio", icon: "bi-mic", duration: "8 Menit", color: "text-warning" },
            { id: 4, title: "Reframing: Ubah Sudut Pandang", desc: "Mengubah pikiran negatif menjadi umpan balik positif.", type: "Studi Kasus", category: "text", icon: "bi-arrow-repeat", duration: "12 Menit", color: "text-info" },
            { id: 5, title: "Manajemen Stress Ujian", desc: "Tips menghadapi tekanan ujian dengan tenang.", type: "Video", category: "video", icon: "bi-film", duration: "20 Menit", color: "text-danger" },
            { id: 6, title: "Membangun Empati", desc: "Latihan menempatkan diri di posisi orang lain.", type: "Materi Teks", category: "text", icon: "bi-people", duration: "10 Menit", color: "text-primary" }
        ];

        // --- 4. RENDER MODUL KE HTML ---
        const container = document.getElementById('moduleContainer');

        function renderModules(filter = 'all') {
            let htmlContent = '';
            
            // Filter Data
            const filteredData = filter === 'all' 
                ? modulesData 
                : modulesData.filter(m => m.category === 'audio' || m.type.includes('Audio'));

            filteredData.forEach(mod => {
                htmlContent += `
                    <div class="col-md-6 col-lg-4">
                        <div class="card module-card shadow-sm p-3 h-100" onclick="showModuleDetail(${mod.id})">
                            <div class="card-body">
                                <div class="d-flex justify-content-between align-items-start mb-3">
                                    <div class="card-icon-wrapper bg-light">
                                        <i class="bi ${mod.icon} ${mod.color}"></i>
                                    </div>
                                    <span class="badge bg-light text-dark border" style="font-size:0.7rem;">${mod.type}</span>
                                </div>
                                <h6 class="card-title fw-bold mb-2">${mod.title}</h6>
                                <p class="card-text text-muted small mb-3 text-truncate-2">
                                    ${mod.desc}
                                </p>
                                <div class="d-flex align-items-center text-muted small">
                                    <i class="bi bi-clock me-1"></i> ${mod.duration}
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            });

            container.innerHTML = htmlContent;
        }

        // --- 5. INTERAKSI BUTTON FILTER ---
        function filterModules(type, btn) {
            const buttons = btn.parentElement.querySelectorAll('button');
            buttons.forEach(b => {
                b.classList.remove('btn-outline-primary', 'active');
                b.classList.add('btn-outline-secondary');
            });
            btn.classList.remove('btn-outline-secondary');
            btn.classList.add('btn-outline-primary', 'active');
            renderModules(type);
        }

        // --- 6. MODAL DETAIL & NAVIGASI KE MATERI ---
        function showModuleDetail(id) {
            const selectedModule = modulesData.find(m => m.id === id);
            
            document.getElementById('modalTitle').innerText = selectedModule.title;
            document.getElementById('modalDesc').innerText = selectedModule.desc;
            document.getElementById('modalBadge').innerText = selectedModule.type;
            document.getElementById('modalDuration').innerText = selectedModule.duration;

            // Navigasi ke file materi.html di folder yang sama
            const btnStart = document.getElementById('btnStartLearning');
            btnStart.onclick = function() {
                window.location.href = `materi.html?id=${id}`; 
            };

            var myModal = new bootstrap.Modal(document.getElementById('moduleModal'));
            myModal.show();
        }

        // Simulasi Audio Cepat
        function playQuickAudio(title) {
            Swal.fire({
                title: 'Memutar Audio...',
                text: `Sedang menyiapkan sesi "${title}"`,
                timer: 1500,
                showConfirmButton: false,
                willOpen: () => { Swal.showLoading() }
            }).then(() => {
                // Di real app, ini akan membuka player
                window.location.href = 'materi.html?mode=quick&title=' + encodeURIComponent(title);
            });
        }

        // Jalankan saat load
        renderModules('all');

    </script>
</body>
</html>